<!-- Loader -->
<div *ngIf="isLoading" class="h-[70vh] flex items-center justify-center p-4 mb-4 rounded">
  <mat-spinner></mat-spinner>
</div>

<!-- Fiche Produit -->
<div *ngIf="!isLoading && product" class="p-4 md:p-10 bg-white rounded-lg shadow-sm">

  <!-- Catégorie -->
  <div class="bg-teal-600 text-white px-4 py-2 rounded-t">
    <p class="text-xl capitalize italic">{{ product?.category?.name }}</p>
  </div>

  <!-- Contenu principal -->
  <div class="flex flex-col md:flex-row gap-10 mt-4">

    <!-- Infos produit -->
    <div class="flex-1 flex flex-col gap-4">
      <h3 class="text-lg font-semibold text-teal-700 capitalize">{{ product?.brand?.name }}</h3>
      <h2 class="text-2xl font-bold text-gray-900"><span class="capitalize">{{ product?.name.slice(0,1) }}</span>{{
        product?.name.slice(1,product?.name.length) }}</h2>
      <p class="text-gray-700 leading-relaxed"><span class="capitalize">{{ product?.description.slice(0,1) }}</span>{{
        product?.description.slice(1,product?.description.length) }}</p>

      <div class="border-t pt-4 mt-4">
        <p class="text-md font-semibold mb-2">Modèles disponibles</p>

        <div *ngFor="let variation of product?.variations"
          class="flex flex-wrap md:flex-nowrap items-center justify-between gap-2 p-2 border rounded hover:shadow-sm transition"
          [class.opacity-50]="variation.stock === 0" [class.pointer-events-none]="variation.stock === 0">

          <span class="capitalize w-20 ">{{ variation?.gender }}</span>
          <span class="uppercase w-20 ">{{ variation?.size }}</span>
          <span class="w-6 h-6 rounded-full border" [style.backgroundColor]="variation.color"></span>
          <span class="text-sm font-medium w-32 ">
            {{ variation.stock >= 1 ? 'Disponible' : 'Pas de stock' }}
          </span>

          <div class="flex gap-2">

            <!-- Ajouter au panier -->
            <span (click)="variation.stock >= 1 && addProductToCart(product, variation)"
              class="material-symbols-outlined transition" [class.text-teal-600]="variation.stock >= 1"
              [class.text-gray-400]="variation.stock < 1" [class.cursor-pointer]="variation.stock >= 1"
              [class.pointer-events-none]="variation.stock < 1" [class.hover\:text-teal-800]="variation.stock >= 1">
              add_shopping_cart
            </span>

            <!-- Retirer du panier -->
            <span (click)="variation.stock >= 1 && deleteProductFromCart(product.id, variation.id)"
              class="material-icons transition" [class.text-red-500]="variation.stock >= 1"
              [class.text-gray-400]="variation.stock < 1" [class.cursor-pointer]="variation.stock >= 1"
              [class.pointer-events-none]="variation.stock < 1" [class.hover\:text-red-700]="variation.stock >= 1">
              remove_shopping_cart
            </span>

          </div>

        </div>
      </div>

      <p class="text-3xl font-bold text-teal-600 mt-6">{{ product?.price }} €</p>
    </div>

    <!-- Galerie d’images -->
    <div *ngIf="product?.medias?.length > 0" class="flex-1 flex flex-col gap-4">
      <div class="relative w-full h-[400px] border rounded overflow-hidden">
        <img *ngFor="let media of product.medias; let i = index" [src]="media.url"
          [class.opacity-100]="i === firstMedia" [class.opacity-0]="i !== firstMedia"
          class="transition-opacity duration-500 absolute top-0 left-0 w-full h-full object-contain bg-white" />
      </div>

      <div class="flex items-center justify-center gap-2">
        <span class="material-icons cursor-pointer text-gray-600 hover:text-teal-600"
          (click)="prevImage()">chevron_left</span>

        <img *ngFor="let media of product.medias; let i = index" [src]="media.url" (click)="selectImage(i)"
          class="w-16 h-16 object-cover cursor-pointer border-2 rounded" [class.border-blue-500]="i === firstMedia"
          [class.border-gray-300]="i !== firstMedia" />

        <span class="material-icons cursor-pointer text-gray-600 hover:text-teal-600"
          (click)="nextImage()">chevron_right</span>
      </div>
    </div>

    <!-- Si aucun média -->
    <div *ngIf="product && product.medias.length === 0" class="text-gray-500 italic">
      Aucun média lié à ce produit.
    </div>
  </div>

</div>